#!/bin/sh

mount -t proc none /proc
echo -e "\nuptime: $(cut -d' ' -f1 /proc/uptime) seconds\n" >> /dev/console

PATH=/usr/local/sbin:/usr/sbin:/sbin:/usr/local/bin:/usr/bin:/bin:.

mount -t sysfs none /sys
#mount -t devtmpfs none /dev
mkdir /dev/pts
mount -t devpts none /dev/pts

OUTPUT="/dev/null 2>&1"
ENTRY_POINT=/etc/init.d/sdfirm

echo "  _      _"
echo " | |    (_)"
echo " | |     _ _ __  _   ___  __"
echo " | |    | | '_ \\| | | \\ \\/ /"
echo " | |____| | | | | |_| |>  <"
echo " |______|_|_| |_|\\__,_/_/\\_\\"
echo ""
echo "===== Factory Address ====="
echo "192.168.10.1/255.255.255.0"
echo "==========================="
if [ -e /sys/class/net/lo ]; then
	ip addr add 127.0.0.1/8 dev lo
	ip link set lo up
	route add -net 127.0.0.0/8 dev lo
fi
if [ -e /sys/class/net/eth0 ]; then
	ip addr add 192.168.10.1/24 dev eth0
	ip link set eth0 up
	# IPUPDOWN via IP
	#
	# This requires ip route plugin:
	# ip route add default via 192.168.10.254 dev eth0
	route add -net 192.168.10.0/24 dev eth0
	route add default gw 192.168.10.254
fi

stty sane -F /dev/tty1 > $OUTPUT
cat /etc/uk.bmap | loadkmap > $OUTPUT
hostname sdfirm > $OUTPUT
ldconfig > $OUTPUT

if [ -f /etc/init.d/test_early ]; then
	/etc/init.d/test_early
fi

$ENTRY_POINT start

if [ -f /etc/init.d/test_late ]; then
	/etc/init.d/test_late
fi

#/bin/sh -i
